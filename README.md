# <img style="max-height: 40px;" height="40px" src="http://geteal.com/img/ealbrand.png" alt="ealbrand"><span class="span_brand">AL</span>
Easy to learn Easy to use scripting language EAL (Easy application language)<br>
http://www.geteal.com - licence and documentation<br>
ealbuild_fb_ssl_incl.zip - distributive for Windows 64bit, including firebird and openssl librarys<br>
Credentials:
Author and developer: Andrey Fedorov
<h1 align="center">Скриптовый язык программирования EAL.</h1>
<h2>Введение</h2>
	<p>Скриптовый язык программирования EAL выполняется в реальном времени и не производит предварительного синтаксического разбора и компиляции. Предназначен для написания web ориентированных приложений с легко изменяемым кодом. В своем арсенале имеет широкий набор  необходимых функций. Синтаксис языка регистр зависимый, т.е. а и А две разные переменные, либо названия. </p>
<ul>
	<li>EAL представляет собой бинарный файл на вход которого подается написанный скрипт. </li>
	<li>EAL кроссплатформенное консольное приложение. </li>
	<li>EAL встроен TCP сервер работающий на неблокируемых сокетах.</li>
	<li>EAL встроены функции для работы с СУБД Firebird.</li>
<h2>Список зарезервированных слов</h2>
	<p>Список зарезервированных EAL слов (список может быть неполным):</p>
<p color="gray">if while for repeat else until break function done fi end loop rof fore erof in cm mc nuf uses uselyb lyb try exc yrt fin Ealerror  fexit res pe out</p>
<h2>Функция out(text)</h2>
<p>	Встроенная функция out выводит на консоль переданный текст.</p>
<h2>Функция free(var)</h2>
	<p>Функция удаляет переменную из памяти. Можно передавать как элемент, так и весь массив.</p>
	<h2>Директива uses</h2>
	<p>Позволяет разбить скрипт на модули, и вызвать нужный модуль в любом месте uses name1,name2..,nameN;</p>
	<h2>Используемые типы</h2>
	<p>Используется четыре типа переменных: строка, число, именованный массив, массив</p>
	<h2>Объявление переменных</h2>
	<p>
		Переменные объявляются в любом месте, где нужно их использовать. Объявленные переменные внутри функции, доступны только в ней. Объявленные переменные вне функций считаются глобальными и доступны везде.
	</p>
	<p>
		Следующий пример вызовет ошибку:
function tell_number()<br>
	tell=54;<br>
	res=tell;<br>
	nuf<br>
out(tell);<br>
Полученная ошибка:<br>
Exception:Error:No such Ident tell On string # 5; Peace of string: out(tell);; EAL error at index = 58 at char = ); Conditions: <br>
Ошибка чтения параметров! Ошибка: Error:Error:No such Ident tell On string # 5; Peace of string: out(tell); On string # 5; Peace of string: out(tell);:<br>
	Исправим код:<br>
	function tell_number()<br>
	tell=54;<br>
	res=tell;<br>
	nuf<br>
tell=tell_number();<br>
out(tell);<br>
Результат:<br>
54
</p>
<h2>Числовые переменные</h2>
<p>Могут быть вещественными и целыми. Доступны все математические операции.<br>
	number=1;<br>
number=2.5;<br>
number=10/2*5-10*(0+1);<br>
</p>
<h2>Строковые переменные</h2>
	<p>Задаются одинарными кавычками. Строки можно склеивать, в том числе и с числовыми переменными в результате получится строка.<br>
	String=;<br>
	String=' It is '+number+'! Good.';<br>
	или возможна запись:<br>
	String=' It is $(number);! Good.';<br>
	Строка начинается, с индекса 1.<br>
	Out(String[1]), выведет I;<br>
</p>
<h2>Именованный массив<br></h2>
	<p>
		Для объявления используются фигурные скобки. Каждый элемент, включая последние, должен заканчиваться “;”:<br>
		Named_array={};<br>
	Или<br>
	Named_array={a=5;b=6;c=7;};<br>
	Добавление элемента происходит через точку:<br>
	Named_array.t=8;<br><br>
		Вызов элемента:<br><br>
		out(Named_array.t+Named_array.a);<br><br>
		Результат: 13<br><br>
		Удаление элемента:<br><br>
		free(Named_array.t);<br>
	Узнать все элементы массива, можно просто вызвав переменную:<br><br>
		out(Named_array);<br>
	Результат: a b c<br>
</p>
<h2>Массивы<br></h2>
		<p>Задаются квадратными скобками. Любой элемент может быть любой переменной. Каждый элемент включая последние должен заканчиваться “;” .<br>
		Array=[];<br><br>
			или<br><br>
			Array=[1;{m=6;n=7;k=8;};[20;40;60;];];<br><br>
			Добавление элемента в массив:<br><br>
			Array=[4;];<br>
	Вызов элемента из массива:<br><br>
		out(Array[0]); выведет 1<br><br>
		out(Array[1]); выведет m n k<br><br>
		out(Array[1].n); выведет 7<br><br>
		out(Array[2][0]); выведет 20<br>
</p>
<h2>Вычисления и операции <br></h2>
	<p>	Для вычислений используются стандартные математические операции: сложение(+), вычитание(-), деление(/), умножение(*), круглые скобки(). Приоритет вычислений по правилам арифметики.<br>
		M=0;<br>
	M=M+5;<br><br>
		T=M-4;<br><br>
		K=4/4+4*(5+1)/3+2-4+5*(20-19);<br><br>
		L=2.2+1.8;<br>
	Результат выполнения:<br><br>
		K=12 T=1 M=5 L=4<br><br>
	</p><br>
	<h2>Операторы сравнения<br></h2>
	<p>
		Для сравнения используются четыре оператора:<br>
		! – неравно<br>
			| - или<br>
	& - и<br>
	= - равно<br>
</p>
<h2>Ветвление - конструкция if()..fi и if()..else..fi<br></h2>
		<p>Конструкция всегда начинается с if, а затем в круглых скобках задается условие, заканчивается fi:<br>
		if (…)<br>
	…<br>
	fi<br>
	или<br>
	if ((...)&(...))<br>
	…<br>
	else<br>
	…<br>
	fi<br>
	Так же возможно использовать вложенные конструкции:<br>
	if ((...)|(...)&(...))<br>
		if ()<br>
		fi<br>
		fi<br>
	</p>
<h2>Циклы<br></h2>
		<p>Цикл for (переменная;выражение;условие)…rof. Пока условие верно для переменной, будет выполняться код в цикле. Например:<br>
		for (i=0;i=i+1;i<10)<br>
		out(i);<br>
		rof<br>
	Результат:<br>
	0<br>
	1<br>
	2<br><br>
		3<br>
	4<br>
	5<br>
	6<br>
	7<br>
	8<br>
	9<br>
</p>
<p>
		<h2>Цикл fore in (строка со значениями, разделенными пробелом) … erof. Цикл удобно использовать с именованным массивом. Пример:<br></h2>
		Array=[{name='Andrew';lastname='Good';};];<br>
	Array=[{name='Paul';lastname='Goodest';};];<br>
	Array=[{name='Victor';lastname='Best';};];<br>
		Array2=[26;17;18;];<br>
	for (i=0;i=i+1;i<Array) <br>
		<br>out('Запись #'+i+':');<br>
		fore k in (Array[i])<br>
			out(k+':'+Array[i].$k);<br>
			erof<br>
		out('age:'+Array2[i]);<br>
		rof<br>
	Результат выполнения:<br>
	Запись #0:<br>
	name:Andrew<br>
	lastname:Good<br>
	age:26<br>
	Запись #1:<br>
	name:Paul<br>
	lastname:Goodest<br>
	age:17<br>
	Запись #2:<br>
	name:Victor<br>
	lastname:Best<br>
	age:18<br>
</p>
<p>
	<h2>Цикл while (условие)…done. Пока будет условие верно для переменной, будет выполняться код в цикле. Например:<br></h2>
	i=0;<br>
	while (i<5)<br>
		out(i);<br>
		i=i+1;<br>
		done<br>
	Результат выполнения:<br>
	0<br>
	1<br>
	2<br>
	3<br>
	4<br>
</p><br>
	<p><br>
		<h2>Цикл repeat…until (условие). Пока будет условие верно для переменной, будет выполняться код в цикле. Например:<br></h2>
		i=0;<br>
	repeat<br>
	out(i);<br>
	i=i+1;<br>
	until (i<5);	<br>
	Результат выполнения:<br>
	0<br>
	1<br>
	2<br>
	3<br>
	4<br>
</p><p>
		Прерывание цикла осуществляется оператором break.<br>
		</p>

<h2>		Бесконечный цикл loop…done.<br> </h2>
<p>Например:<br>
	i=0;<br>
	loop<br>
		i=i+1;<br>
		out(i);<br>
		if (i=11)<br>
			break<br>
		fi	<br>
		done<br>
	Результат выполнения:<br>
	1<br>
	2<br>
	3<br>
	4<br>
	5<br>
	6<br>
	7<br>
	8<br>
	9<br>
	10<br>
	11<br>
</p>
<h2>Конструкции try и обработка ошибок<br></h2>
		<p>Конструкция языка try..fin..yrt позволяет в секции fin выполнить код в любом случае, кроме досрочного выхода из функции fexit.<br>
		Конструкция языка try..exc..yrt позволяет в секции exc выполнить код в случае ошибки, последняя ошибка хранится в переменной ealerror.<br>
		Пример:<br>
	number=5;<br>
	<br>
	try<br>
		try<br>
			n=2/0;<br>
		exc<br>
			out('From try..exc: '+ealerror);<br>
		yrt<br>
		fin<br>
		number=0;<br>
		yrt<br>
	<br>
	out(number);<br>
	<br>
	Результат выполнения:<br>
	From try..exc: Division by zero<br>
	0<br>
	<br>
</p>
<h2>Функции<br></h2>
		<p>Функции можно объявлять в любом месте, кроме внутри самой функции function имя(var1,..,varN)..nuf. Функция обязательно должна содержать переменную res. Досрочное прекращение выполнения fexit.<br>
		Пример 1:<br>
	function hw(name,age)<br>
	res='Hello world! From '+name+', '+age+' years old!';<br>
	nuf<br>
	<br>
	out(hw('Andrew','33'));<br>
	<br>
	Результат выполнения:<br>
	Hello world! From Andrew, 33 years old!<br>
</p>

<h2>Указатель "$"</h2>
		<p>
		Указывает , что значение в текущей переменной это наименование любой ранее объявленной переменной или функции.<br>
		Пример:<br>
	Если в функцию передать массив, то в переменной будет количество элементов, так же если передать именованный массив, то будет строка с разделенными через пробел элементами. Чтобы использовать сам массив, можно передать его имя, и с помощью указателя производить действия над ним.<br>
	Array=[{name='Andrew';lastname='Good';};];<br>
	Array=[{name='Paul';lastname='Goodest';};];<br>
	Array=[{name='Victor';lastname='Best';};];<br>
	Array2=[26;17;18;];<br>
	<br>
	function show(name1,name2)<br>
	<br>
	for (i=0;i=i+1;i<$name1)<br>
	        out('Запись #'+i+':');<br>
	        fore k in ($name1[i])<br>
	                out(k+':'+$name1[i].$k);<br>
	                erof<br>
	        out('age:'+$name2[i]);<br>
	        rof<br>
	res='ok';<br>
	nuf<br>
	<br>
	show('Array','Array2');<br>
	Результат выполнения:<br>
	Запись #0:<br>
	name:Andrew<br>
	lastname:Good<br>
	age:26<br>
	Запись #1:<br>
	name:Paul<br>
	lastname:Goodest<br>
	age:17<br>
	Запись #2:<br>
	name:Victor<br>
	lastname:Best<br>
	age:18<br>
	<br>
</p>
<p> При использовании в строке выполняет код внутри круглых скобок ()<br>
Например:<br>
world='world';<br>
str='Hello $(world);';<br>
out(str);<br>
Результат:<br>
Hello world<br>
</p>
<p>
	Данная конструкция используется при выводе на экран двух чисел, например:<br>
a=5;<br>
b=6;<br>
out(a+b); #результат 11 <br>
out('$a;+$b;'); #результат 5+6 <br>
 </p>
<h2> Экранирование - \ </h2><br>
<p> Используется  в строках: 
<br>\r - возврат коретки
<br>\n - новая строка
<br>\t - табуляция
<br>\$ - $
<br>\\ - \
<br>\' - '
<br>
</p>
<h1>Встроенные функции</h1>
<h2>Специальные функции</h2>
<br>isVar(variable) – если переменная была объявлена раннее то возвращает 1, в противном случае 0.
<br>free(var1) — удалить из памяти переменную var1.
<br>gfree(var1) – удалить из памяти переменную объявленную вне функций.
<br>sleep(var1) — пауза на var1 миллисекунд
<br>ESGetOs() - возвращает строку с текущей операционной системой windows или linux
<br>ESGetEalLocation() — возвращает строку с адресом где находится eal.exe
<br>ESRaiseError(var1) — прерывание исполнения скрипта с ошибкой var1 
<br>ESChr(var1) – возвращает символ соответствующий ASCII таблице. Var1 числовое значение
<br>ESOrd(var1) — возвращает числовое значение соответствующее ASCII символу. Var1 символ
<br>
<h2>Специальные серверные функции</h2>
<br>ESTse(var1) – исполнение скрипта в безопасном режиме, очередь последовательного исполнения. Функция доступна в серверном режиме.
<br>sout(var1) – используется в серверном режиме, для отложенной записи лога.
<br>ESCash(var1) — возвращает результат выполнения функции Cashout, если был указан параметр cash в настройках сервера.
<br>ESSockRecv() – возвращает полученную строку от клиента. Если используется без инициализации сервера, то возвращает полученную строку со stdin. 
<br>ESSockSend(var1) – отправить строку в var1 клиенту. Если не в серверном режиме, то в stdout.
<br>ESSockSendData(var1) – отправить данные в var1 клиенту. Если не в серверном режиме, то в stdout.
<br>ESSockRecvData(var1) – возвращает данные полученные от клиента. Var1 – размер получаемых данных.
<br>
<h2>Математические функции</h2>
<br>ESMd5(var1) — возвращает строку с вычисленным хешем md5. Var1 – данные для вычисления хеша.
<br>ESRandomize() - инициализация генератора случайных чисел. Применяется перед использованием RandomRange; 
<br>ESRandomRange(var1,var2) — возвращает случайное численное значение в диапазоне от var1 до var2, не включая var2. Требует инициализации вызовом ESRandomize();
<br>
<h2>Командная строка</h2>
<br>ESRln() - читает строку с консоли
<br>out(var1) – вывод stdout. В серверном режиме запись в лог.
<br>ESExecProc(var1,var2) – var1 исполняемая команда, var2 параметры
<br>ESExecProcE(var1,var2,var3) – var1 исполняемая команда, var2 окружение, var3 входные данные stdin. Timeout 150 секунд.
<br>
<h2>Изображение </h2>
<br>ESImageCompress(var1,var2,var3,var4,var5,var6,var7) – возвращает преобразованное изображение. Var1 – изображение для модификации, var2 — качество от 0 .. 100, var3 — желаемая ширина рисунка в пикселях, var4 — желаемая высота рисунка в пикселях, var5 — тип изображения, может быть png, или любое другое значение равно jpeg, var6 – надпись на изображение, если пустая строка, то отсутствует, var7 – цвет надписи в шестнадцатеричном формате
<br>ESImageRotate(var1,var2,var3) – поворачивает изображение на 90,180,270 градусов. Var1 — изображение для модификации, var2 — 90,180,270, любое другое значение это 0, var3 — тип изображение 'png', любое другое значение jpeg.
<br>
<h2>Интернет</h2>
<br>ESBase64Encode(var1) – возвращает закодированное значение var1 в Base64
<br>ESBase64Decode(var1) – возвращает декодированное значение var1 из Base64
<br>ESUrld(var1) — возвращает декодированный url запрос
<br>
<h2>Строки и шаблоны</h2>
<br>ESUpperCase(var1) – возвращает строку var1 в верхнем регистре
<br>ESLowerCase(var1) — возвращает строку var1 в нижнем регистре
<br>ESStringReplace(var1,var2,var3) – возвращает var3 со всеми var1 замененными var2
<br>ESStringReplace2(var1,var2,var3) – возвращает var3 со всеми var1 замененными var2
<br>ESRegExpReplace(var1,var2,var3) – возвращает var3 со всеми var1(регулярное выражение) замененными var2
<br>ESLen(var1) — возвращает длину данных в переменной var1
<br>ESPos(var1,var2) — возвращает номер индекса с которой начинается var1 в var2. Поиск начинается сначала строки.
<br>ESPosEx(var1,var2,var3) — возвращает номер индекса с которой начинается var1 в var2. Поиск начинается с индекса var3 строки.
<br>ESCopy(var1,var2,var3) – возвращает часть var1, начиная с индекса var2 до индекса var3.
<br>
<h2>Дата и время</h2>
<br>ESDate() - возвращает текущую дату установленную в ОС в цифровом формате дд.мм.гггг 
<br>ESCompareDate(var1,var2) — var1,var2 даты для сравнения в цифровом формате дд.мм.гггг возвращает значение <0, если var2>var1, 0 var1=var2, >0 var1>var2
<br>ESCompareTime(var1,var2) - var1,var2 время для сравнения в цифровом формате дд.мм.гггг чч:мм:сс дата игнорируется при сравнении, возвращает значение <0, если var2>var1, 0 var1=var2, >0 var1>var2
<br>ESMillisecondsDate(var1) — возвращает количество миллисекунд прошедших с 01.01.1970 до var1 в формате дд.мм.гггг чч:мм:сс
<br>ESNow() - возвращает текущую дату и время ос в формате дд.мм.гггг чч:мм:сс
<br>ESMilliseconds() - возвращает количество миллисекунд прошедших с 01.01.1970 до текущей даты и времени в ос. 
<br>ESMillisecondsUTC() -  возвращает количество миллисекунд прошедших с 01.01.1970 до текущей даты и времени в ос в UTC
<br>ESTime() - возвращает текущее время ос в формате чч:мм:сс 
<br>Esrfcdt() - возвращает текущую дату и время в rfc822
<br>
<h2>Файлы</h2>
<br>ESFileList(var1, var2) – возвращает строку c полным путем файлов разделенными пробелами в директории var1, var2 – может быть пустым, тогда поиск файлов осуществляется в текущей директории или 'all', тогда поиск файлов будет происходить и в под директориях.  
<br>ESGzip(var1) – возвращает сжатый var1
<br>ESGunzip(var1) – возвращает разархивированный var1
<br>ESLoadFile(var1) — возвращает файл по пути var1. Var1 – адрес файла 
<br>ESLoadFileStream(var1) — возвращает файл по пути var1. Var1 – адрес файла 
<br>ESFileLoad(var1)  — возвращает файл по пути var1. Var1 – адрес файла 
<br>ESSaveFile(var1,var2) — сохранить var2 в файл var1
<br>
<h2>База данных FireBird</h2>
<br>ESDbInit(var1) - возвращает 0 или -1 в случае ошибки. Var1 – строка подключения к базе данных с параметрами разделенными ";"  Пример: connstring='hostname=127.0.0.1;dbname=c:\db\db.fdb;dbuser=SYSDBA;dbpass=123;locale=utf8;';
<br>ESExecSql(var1,var2,var3) – возвращает количество строк полученное при выполнение запроса select или update returning, 0 или -1 в случае ошибки. Var1 – имя массива куда будут записаны результаты выполнения запроса select или update returning, может быть пустым, если обычный update или delete, массив состоит из именованных массивов, равный количеству полученных строк, именнованный массив содержит название коллонки и значение [{col1=val1;col2=val2;col3=val3; .. coln=valn;};{col1=val1;col2=val2;col3=val3; .. coln=valn;}; .. {col1=val1;col2=val2;col3=val3; .. coln=valn;};]; var2 – запрос sql, обязательно для заполнения; var3 – заполняется в случаях параметризованного запроса Update или Insert для заполнения блоб поля, параметр поддерживается только один. 
<br>ESDbCreate(var1) – возвращает 0 или -1 в случае ошибки. Var1 – параметры для создания базы данных в виде списка dbname,dbuser,dbpass,locale,page  
<br>ESDbClose() - закрытие подключения к базе данных.
<br>
<h2>Почта</h2>
<br>ESDnsMx(var1,var2) – возвращает список mx серверов отсортированных по приоритету. Var1 – dns сервер; var2 – доменное имя почтового сервера
<br>
<h2>Сеть</h2>
<br>ESConnClose() - закрывает соединение установленное ESConn, ESConnSSL, возвращает -1 в случае ошибки. 
<br>ESConnRecv(var1) — возвращает строку полученную от сервера. Var1 - timeout
<br>ESConnSend(var1) – отправка строки или любых двоичных данных, возвращает -1 в случае ошибки. Var1 – данные для отправки.
<br>ESConn(var1,var2,var3) — подключение к серверу, возвращает -1 в случае ошибки. Var1 – ip куда подключаться var2 - порт var3 — таймаут. 
<br>ESConnSSL(var1,var2,var3)  — подключение к серверу с использованием шифрования, возвращает -1 в случае ошибки. Var1 – ip куда подключаться var2 - порт var3 — таймаут.  
<br>ESConnRecvData(var1,var2) — возвращает данные полученные от сервера. Var1 – размер получаемых данных, если 0 , то все, что есть в буфере; var2 - таймаут
<br>
<br>
<h1>Встроенный tcp сервер</h1>
<p>
	Для работы сервера, необходимо создать необходимые файлы и директории командой: eal -install <br>
	- для линукса создастся директория /etc/eals<br>
	- для windows в расположение eal.exe директория ./config<br>
	В директории создастся глобальный файл настройки eals.conf и поддиректория srv<br>
	В файле eals.conf можно настроить префикс для linux и windows, для общей папки с проектами, которая будет подставляться при обработки конфига и инициализации указанных файлов.<br><br>
	В дальнейшем параметры можно считать из ESinfo.pf_win, ESinfo.pf_lin, а также ESinfo.prefix, который будет содержать иницилизованный параметр для текущей ОС.  <br>
	В поддиректории srv создастся файл test, с возможными параметрами для старта сервера.<br>
	<p><br>
		ip - 0.0.0.0  <br>
		#ip для ожидания входящих подключений. 0.0.0.0 означает, что слушать будет на всех доступных интерфейсах. <br>
		port - 80 <br>
		# порт для приема входящих подключений<br>
		protocol - c:/eal/modules/http.eal <br>
		# указывается скрипт для взаимодействия с клиентом.<br>
		<br>
		ssl = yes <br>
		# использовать защищенное подключение<br>
		sslca=/www/eal/ssl/rootEAL.pem <br>
		# корневой сертификат <br>
		sslcert=/www/eal/ssl/eals.pem <br>
		# сертификат сайта<br>
		sslkey=/www/eal/ssl/eals.key <br>
		# приватный ключ<br>
		sslpass=/www/eal/ssl/ealsp <br>
		# пароль, если нужен<br>
		# если ssl=no, тогда настройки sslca, sslcert, sslkey, sslpass можно удалить или закомментировать
<br>
	log=c:/inwork/backoffice/bo_log_<br>
	#Путь к логу сервера, будет к концу файла подставлять дату<br>
	<br>
	#num_thr=16<br>
	#не используется в последних версиях
<br>
	#можно объявить любые переменные, которые потом будут доступны в именнованом массиве ESinfo.<br>
	workdir=d:/www/bestproject<br>
	#Будет доступно ESinfo.workdir<br>
</p><br>
<p><br>
	После внесения необходимых настроек, нужно запустить сервер. Предпочтительно дать необходимые полномочия исполняему файлу eal.<br>
	Запуск нужного конфига производится командой: eal -conf test<br>
	В данном случае похватится конфигурация srv/test<br>
</p><br>
<p><br>
	В Windows возможен запуск сервера, как сервиса:  eal -rservice -iservice test<br>
	После выполнения данной команды, сервис с именем EalServer(test) появится в службах<br>
</p>
</p>
